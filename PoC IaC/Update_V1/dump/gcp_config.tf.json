{
  "terraform": {
    "required_version": ">= 1.0",
    "required_providers": {
      "google": {
        "source": "hashicorp/google",
        "version": "~> 5.0"
      }
    }
  },
  "provider": {
    "google": {
      "project": "${var.project_id}",
      "region": "${var.region}"
    }
  },
  "variable": {
    "project_id": {
      "description": "GCP Project ID",
      "type": "string"
    },
    "region": {
      "description": "GCP region",
      "type": "string",
      "default": "us-central1"
    },
    "zone": {
      "description": "GCP zone",
      "type": "string",
      "default": "us-central1-a"
    }
  },
  "resource": {
    "google_compute_network": {
      "test_network": {
        "name": "test-network",
        "auto_create_subnetworks": false,
        "description": "Test VPC network for scanning"
      }
    },
    "google_compute_subnetwork": {
      "test_subnet": {
        "name": "test-subnet",
        "ip_cidr_range": "10.0.0.0/24",
        "region": "${var.region}",
        "network": "${google_compute_network.test_network.id}",
        "private_ip_google_access": false
      }
    },
    "google_compute_firewall": {
      "allow_ssh_from_anywhere": {
        "name": "allow-ssh-from-anywhere",
        "network": "${google_compute_network.test_network.name}",
        "allow": [
          {
            "protocol": "tcp",
            "ports": ["22"]
          }
        ],
        "source_ranges": ["0.0.0.0/0"],
        "priority": 1000
      },
      "allow_rdp_from_anywhere": {
        "name": "allow-rdp-from-anywhere",
        "network": "${google_compute_network.test_network.name}",
        "allow": [
          {
            "protocol": "tcp",
            "ports": ["3389"]
          }
        ],
        "source_ranges": ["0.0.0.0/0"],
        "priority": 1000
      }
    },
    "google_service_account": {
      "test_service_account": {
        "account_id": "test-service-account",
        "display_name": "Test Service Account"
      }
    },
    "google_compute_instance": {
      "test_vm_instance": {
        "name": "test-vm-instance",
        "machine_type": "n1-standard-1",
        "zone": "${var.zone}",
        "boot_disk": [
          {
            "initialize_params": [
              {
                "image": "debian-cloud/debian-11",
                "size": 10
              }
            ]
          }
        ],
        "network_interface": [
          {
            "network": "${google_compute_network.test_network.name}",
            "subnetwork": "${google_compute_subnetwork.test_subnet.name}",
            "access_config": [{}]
          }
        ],
        "service_account": [
          {
            "email": "${google_service_account.test_service_account.email}",
            "scopes": ["cloud-platform"]
          }
        ],
        "metadata": {
          "startup-script": "#!/bin/bash\nexport API_KEY=\"hardcoded-key-12345\"\necho \"admin:password123\" > /tmp/creds.txt"
        },
        "tags": ["web", "test"]
      }
    },
    "google_storage_bucket": {
      "test_storage_bucket": {
        "name": "test-storage-bucket-${var.project_id}",
        "location": "US",
        "storage_class": "STANDARD",
        "uniform_bucket_level_access": [
          {
            "enabled": false
          }
        ],
        "versioning": [
          {
            "enabled": false
          }
        ]
      }
    },
    "google_storage_bucket_iam_member": {
      "bucket_public_access": {
        "bucket": "${google_storage_bucket.test_storage_bucket.name}",
        "role": "roles/storage.objectViewer",
        "member": "allUsers"
      }
    },
    "google_sql_database_instance": {
      "test_sql_instance": {
        "name": "test-sql-instance",
        "database_version": "MYSQL_8_0",
        "region": "${var.region}",
        "settings": [
          {
            "tier": "db-f1-micro",
            "backup_configuration": [
              {
                "enabled": false,
                "binary_log_enabled": false
              }
            ],
            "ip_configuration": [
              {
                "ipv4_enabled": true,
                "authorized_networks": [
                  {
                    "name": "allow-all",
                    "value": "0.0.0.0/0"
                  }
                ],
                "require_ssl": false
              }
            ],
            "database_flags": [
              {
                "name": "local_infile",
                "value": "on"
              }
            ]
          }
        ],
        "deletion_protection": false
      }
    },
    "google_sql_database": {
      "test_database": {
        "name": "testdb",
        "instance": "${google_sql_database_instance.test_sql_instance.name}"
      }
    },
    "google_sql_user": {
      "test_sql_user": {
        "name": "admin",
        "instance": "${google_sql_database_instance.test_sql_instance.name}",
        "password": "WeakPassword123"
      }
    },
    "google_project_iam_member": {
      "overly_permissive_binding": {
        "project": "${var.project_id}",
        "role": "roles/owner",
        "member": "serviceAccount:${google_service_account.test_service_account.email}"
      }
    },
    "google_pubsub_topic": {
      "test_pubsub_topic": {
        "name": "test-topic"
      }
    },
    "google_bigquery_dataset": {
      "test_bigquery_dataset": {
        "dataset_id": "test_dataset",
        "location": "US",
        "access": [
          {
            "role": "READER",
            "special_group": "allAuthenticatedUsers"
          }
        ]
      }
    },
    "google_kms_key_ring": {
      "test_kms_keyring": {
        "name": "test-keyring",
        "location": "${var.region}"
      }
    },
    "google_kms_crypto_key": {
      "test_crypto_key": {
        "name": "test-key",
        "key_ring": "${google_kms_key_ring.test_kms_keyring.id}",
        "rotation_period": "31536000s",
        "lifecycle": {
          "prevent_destroy": false
        }
      }
    },
    "google_compute_disk": {
      "unencrypted_disk": {
        "name": "unencrypted-disk",
        "type": "pd-standard",
        "zone": "${var.zone}",
        "size": 10
      }
    },
    "google_container_cluster": {
      "test_gke_cluster": {
        "name": "test-gke-cluster",
        "location": "${var.region}",
        "enable_legacy_abac": true,
        "master_auth": [
          {
            "client_certificate_config": [
              {
                "issue_client_certificate": true
              }
            ]
          }
        ],
        "network_policy": [
          {
            "enabled": false
          }
        ],
        "private_cluster_config": [
          {
            "enable_private_nodes": false,
            "enable_private_endpoint": false
          }
        ],
        "remove_default_node_pool": true,
        "initial_node_count": 1
      }
    },
    "google_container_node_pool": {
      "test_node_pool": {
        "name": "test-node-pool",
        "location": "${var.region}",
        "cluster": "${google_container_cluster.test_gke_cluster.name}",
        "node_count": 1,
        "node_config": [
          {
            "machine_type": "e2-medium",
            "oauth_scopes": [
              "https://www.googleapis.com/auth/cloud-platform"
            ]
          }
        ]
      }
    }
  },
  "output": {
    "network_name": {
      "value": "${google_compute_network.test_network.name}"
    },
    "instance_name": {
      "value": "${google_compute_instance.test_vm_instance.name}"
    },
    "bucket_name": {
      "value": "${google_storage_bucket.test_storage_bucket.name}"
    },
    "sql_instance_name": {
      "value": "${google_sql_database_instance.test_sql_instance.name}"
    }
  }
}